<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated by PHP Project Wizard (PPW) 1.0.4 on Mon Oct 3 15:21:39 CDT 2011 -->

<project name="deb.util" default="build" basedir=".">
    <property name="deb.util.setup" value="${deb.setup}/util"/>
    <property name="deb.util.include" value="${basedir}/include"/>
    <property name="deb.util.bin" value="${basedir}/util"/>
    <property name="deb.util.staging" value="${deb.staging}/util"/>

    <property name="deb.util.outputfile" value="${deb.builddir}/HUGnetScripts_util_${deb.version}${deb.release}_all.deb" />

    <target name="clean" description="Clean up and create artifact directories">
        <delete dir="${deb.util.staging}" failonerror="false"/>
    </target>

    <target name="setup" description="Copy all of the files to build the deb">
        <echo>Setting up for HUGnetScripts 'v${deb.version}'</echo>

        <mkdir dir="${deb.util.staging}"/>
        <copy todir="${deb.util.staging}">
            <fileset dir="${deb.util.setup}"/>
        </copy>
        <mkdir dir="${deb.util.staging}${deb.prefix}/bin"/>
        <copy todir="${deb.util.staging}${deb.prefix}/bin">
            <fileset dir="${deb.util.bin}"/>
        </copy>
        <chmod dir="${deb.util.staging}${deb.prefix}/bin" perm="ugo+rx"
               includes="*"/>
        <chmod file="${deb.util.staging}/DEBIAN/postinst" perm="ugo+rx"/>
        <chmod file="${deb.util.staging}/DEBIAN/prerm" perm="ugo+rx"/>
        <replaceregexp file="${deb.util.staging}/DEBIAN/control" flags="g"
                    match="%VERSION%"
                    replace="${deb.version}"
        />
    </target>
    <target name="deb" description="build the deb">
        <mkdir dir="${deb.builddir}"/>
        <exec executable="dpkg" failonerror="true">
            <arg line="-b ${deb.util.staging}
                       ${deb.util.outputfile}"/>
        </exec>
    </target>
    <target name="sign" description="sign the deb">
        <exec executable="dpkg-sig" failonerror="true" dir="${deb.builddir}">
            <arg line="-s builder
                       ${deb.util.outputfile}"/>
        </exec>
    </target>
    <target name="post" description="post the deb" depends="build">
        <exec executable="rsync" failonerror="true" dir="${deb.builddir}">
            <arg line="-av ${deb.util.outputfile}
                        ${deb.postloc}main/"/>
        </exec>
    </target>
    <target name="testpost" description="post the deb" depends="build">
        <exec executable="rsync" failonerror="true" dir="${deb.builddir}">
            <arg line="-av ${deb.util.outputfile}
                        ${deb.postloc}testing/"/>
        </exec>
    </target>
    <target name="rcpost" description="post the deb" depends="build">
        <exec executable="rsync" failonerror="true" dir="${deb.builddir}">
            <arg line="-av ${deb.util.outputfile}
                        ${deb.postloc}rc/"/>
        </exec>
    </target>
    <target name="postclean" description="build the deb">
        <delete dir="${deb.util.staging}"/>
    </target>
    <target name="build" depends="clean,setup,deb"/>

</project>
